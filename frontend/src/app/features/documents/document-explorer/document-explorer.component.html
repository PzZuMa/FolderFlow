<!-- src/app/features/documents/document-explorer.component.html -->
<div class="explorer-container">
  <!-- Barra de Progreso de Carga Global -->
  <mat-progress-bar mode="indeterminate" *ngIf="isLoading && uploads.length === 0"></mat-progress-bar>

  <!-- Lista de Subidas en Progreso -->
  <div *ngIf="uploads.length > 0" class="upload-section">
    <h4>Subidas en progreso</h4>
    <div class="upload-items-container">
       <div *ngFor="let upload of uploads; let i = index" class="upload-item"
            [ngClass]="{'upload-success': upload.status === 'success', 'upload-error': upload.status === 'error'}">
           <mat-icon class="upload-icon">{{ getIconForMimeType(upload.file.type) }}</mat-icon>
           <div class="upload-info">
             <span class="upload-title">{{ upload.file.name }}</span>
             <span class="upload-details">
                 <span *ngIf="upload.status === 'pending'">Pendiente...</span>
                 <span *ngIf="upload.status === 'uploading'">{{ upload.progress }}%</span>
                 <span *ngIf="upload.status === 'confirming'">Confirmando...</span>
                 <span *ngIf="upload.status === 'success'">¡Listo!</span>
                 <span *ngIf="upload.status === 'error'" class="error-message">{{ upload.error }}</span>
                 - {{ formatBytes(upload.file.size) }}
             </span>
             <mat-progress-bar *ngIf="upload.status === 'uploading' || upload.status === 'confirming'"
                               mode="determinate" [value]="upload.progress" class="upload-progress-bar">
             </mat-progress-bar>
           </div>
       </div>
    </div>
  </div>

  <!-- Contenido Principal (Grid de Tarjetas) -->
  <div class="content-area">
    <div *ngIf="!isLoading" class="grid-container">
      <!-- Documentos -->
      <mat-card *ngFor="let doc of documents" class="grid-item document-card" [matTooltip]="doc.name">
          <mat-card-content>
              <mat-icon class="item-icon">{{ getIconForMimeType(doc.mimeType) }}</mat-icon>
              <span class="item-name">{{ doc.name }}</span>
              <span class="item-details">{{ formatBytes(doc.size) }} | {{ doc.updatedAt | date:'shortDate' }}</span>
          </mat-card-content>
         <!-- Botón de menú para acciones -->
         <button mat-icon-button [matMenuTriggerFor]="itemMenuDoc" (click)="$event.stopPropagation()" class="item-menu-button" aria-label="Acciones de documento">
             <mat-icon>more_vert</mat-icon>
         </button>
         <!-- Menú PARA DOCUMENTOS -->
         <mat-menu #itemMenuDoc="matMenu">
             <button mat-menu-item (click)="downloadFile(doc)">
                <mat-icon>download</mat-icon>
                <span>Descargar</span>
             </button>
             <button mat-menu-item (click)="openMoveDialog(doc, 'document')">
                <mat-icon>drive_file_move</mat-icon>
                <span>Mover a...</span>
             </button>
             <mat-divider></mat-divider>
             <button mat-menu-item (click)="openDeleteConfirmation(doc, 'document')" color="warn">
                <mat-icon>delete</mat-icon>
                <span>Eliminar</span>
             </button>
         </mat-menu>
      </mat-card>
    </div>

    <!-- Mensaje si está vacío -->
    <div *ngIf="!isLoading && folders.length === 0 && documents.length === 0 && uploads.length === 0" class="empty-state">
       <mat-icon class="empty-icon">folder_off</mat-icon>
       <span>Esta carpeta está vacía</span>
       <button mat-raised-button color="primary" (click)="triggerFileInputClick()">Subir primer archivo</button>
    </div>
  </div>

  <!-- Input oculto para subida -->
  <input type="file" hidden #fileInput multiple (change)="onFileSelected($event)">

  <!-- Botón Flotante (FAB) para Subir Archivo -->
  <button mat-fab color="primary" class="upload-fab" (click)="triggerFileInputClick()" matTooltip="Subir archivo" aria-label="Subir archivo">
    <mat-icon>upload</mat-icon>
  </button>
</div>