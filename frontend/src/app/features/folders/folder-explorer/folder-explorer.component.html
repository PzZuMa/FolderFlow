<!-- src/app/features/documents/document-explorer.component.html -->
<div class="explorer-container">

  <!-- ❌ ELIMINAMOS LA TOOLBAR ESPECÍFICA DE ESTE COMPONENTE ❌ -->
  <!-- <mat-toolbar color="primary" class="toolbar"> ... </mat-toolbar> -->

  <!-- Barra de Progreso de Carga Global (Sin cambios) -->
  <mat-progress-bar mode="indeterminate" *ngIf="isLoading && uploads.length === 0"></mat-progress-bar>

  <!-- Lista de Subidas en Progreso (Sin cambios en estructura, podrías ocultarla si no hay uploads) -->
  <div *ngIf="uploads.length > 0" class="upload-section">
    <h4>Subidas en progreso:</h4>
    <div class="upload-items-container">
       <div *ngFor="let upload of uploads; let i = index" class="upload-item"
            [ngClass]="{'upload-success': upload.status === 'success', 'upload-error': upload.status === 'error'}">
           <mat-icon class="upload-icon">{{ getIconForMimeType(upload.file.type) }}</mat-icon>
           <div class="upload-info">
             <span class="upload-title">{{ upload.file.name }}</span>
             <span class="upload-details">
                 <span *ngIf="upload.status === 'pending'">Pendiente...</span>
                 <span *ngIf="upload.status === 'uploading'">{{ upload.progress }}%</span>
                 <span *ngIf="upload.status === 'confirming'">Confirmando...</span>
                 <span *ngIf="upload.status === 'success'">¡Listo!</span>
                 <span *ngIf="upload.status === 'error'" class="error-message">Error: {{ upload.error }}</span>
                 - {{ formatBytes(upload.file.size) }}
             </span>
             <mat-progress-bar *ngIf="upload.status === 'uploading' || upload.status === 'confirming'"
                               mode="determinate" [value]="upload.progress" class="upload-progress-bar">
             </mat-progress-bar>
           </div>
       </div>
    </div>
  </div>


  <!-- Contenido Principal (Grid de Tarjetas) -->
  <div class="content-area">
    <div *ngIf="!isLoading" class="grid-container">

      <!-- Carpetas -->
      <mat-card *ngFor="let folder of folders" class="grid-item folder-card" (click)="navigateToFolder(folder._id)" [matTooltip]="'Abrir carpeta ' + folder.name">
         <mat-card-content>
             <mat-icon class="item-icon">folder</mat-icon>
             <span class="item-name">{{ folder.name }}</span>
             <!-- No hay detalles extra para carpetas aquí -->
         </mat-card-content>
         <!-- Botón de menú para acciones -->
          <button mat-icon-button [matMenuTriggerFor]="itemMenuFolder" (click)="$event.stopPropagation()" class="item-menu-button" aria-label="Acciones de carpeta">
             <mat-icon>more_vert</mat-icon>
          </button>
          <!-- Menú PARA CARPETAS -->
          <mat-menu #itemMenuFolder="matMenu">
              <button mat-menu-item (click)="navigateToFolder(folder._id)">
                <mat-icon>open_in_new</mat-icon>
                <span>Abrir</span>
              </button>
              <!-- ✅ AÑADIR OPCIÓN MOVER ✅ -->
              <button mat-menu-item (click)="openMoveDialog(folder, 'folder')">
                  <mat-icon>drive_file_move</mat-icon>
                  <span>Mover a...</span>
              </button>
             <mat-divider></mat-divider>
             <button mat-menu-item (click)="openDeleteConfirmation(folder, 'folder')" color="warn">
                <mat-icon>delete</mat-icon>
                <span>Eliminar</span>
             </button>
         </mat-menu>
      </mat-card>
    </div>

    <!-- Mensaje si está vacío (sin cambios) -->
    <div *ngIf="!isLoading && folders.length === 0 && documents.length === 0 && uploads.length === 0" class="empty-state">
       <mat-icon class="empty-icon">folder_off</mat-icon>
       <span>Esta carpeta está vacía</span>
       <button mat-stroked-button color="primary" (click)="triggerFileInputClick()">Subir primer archivo</button>
    </div>
  </div>

  <!-- Input oculto para subida (sin cambios) -->
  <input type="file" hidden #fileInput multiple (change)="onFileSelected($event)">

  <!-- FAB (Botón Flotante) - AÑADIR PARA ACCIONES PRINCIPALES -->
  <div class="fab-container">
    <button mat-fab color="accent" class="create-folder-fab" (click)="openCreateFolderDialog()" matTooltip="Nueva Carpeta" aria-label="Crear nueva carpeta">
        <mat-icon>create_new_folder</mat-icon>
    </button>
</div>